<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Lesson2: DS18B20 1-wire Sensor</title>

  <!-- Load Blockly Core & Dependencies -->
  <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
  <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
  <script src="https://unpkg.com/blockly/python_compressed.js"></script>
  <script src="https://unpkg.com/blockly/msg/en.js"></script>

  <!-- External CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/scenario1/lesson2.css') }}">

</head>

<body>

  <div class="container">
    <h1>💧 Lesson2: DS18B20 Sensor</h1>
    <p class="subtitle"><strong>Pins:</strong> VCC (3.3V), GND, DATA (GPIO4)</p>

    <!-- Toolbox -->
    <xml id="toolbox" style="display: none">
      <category name="📦 Import Modules" colour="230">
        <block type="import_glob"></block>
        <block type="import_time"></block>
      </category>
      <category name="🔍 Device Setup" colour="120">
        <block type="get_device_file"></block>
        <block type="define_read_temp_function"></block>
      </category>
      <category name="📖 File Operations" colour="160">
        <block type="open_device_file"></block>
        <block type="read_lines"></block>
        <block type="check_crc"></block>
        <block type="extract_temperature"></block>
        <block type="convert_temperature"></block>
      </category>
      <category name="🔄 Main Loop" colour="65">
        <block type="while_true_loop"></block>
        <block type="call_read_temp"></block>
        <block type="print_temperature"></block>
        <block type="sleep_delay"></block>
      </category>
    </xml>

    <!-- Blockly Workspace -->
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 0.5rem;">
      <div style="flex: 1;"></div>
      <button id="sendBtn" onclick="callSemarAPI('ds18b20')" class="test-btn semar-blue-btn"
        style="margin-right: 0.5rem; display:none;">📡Send to SEMAR</button>
    </div>
    <div id="blocklyDiv"></div>

    <div class="button-container">
      <button onclick="generateCode()">🐍 Generate Python Code</button>
      <button onclick="clearWorkspace()" class="clear-btn">🗑️ Clear </button>
      <button onclick="runCode()" class="run-btn">▶️ Execute</button>
    </div>

    <div class="output-container">
      <div class="output-section">
        <h3>🐍 Generated Python Code:</h3>
        <pre id="output">Click "Generate Python Code" to generate the python code</pre>
      </div>
      <div class="output-section">
        <h3><span class="status-indicator status-ready" id="statusIndicator"></span>🖥️ Execution Output:</h3>
        <pre id="executionOutput"
          class="execution-output">Click "Execute" to see the sensor data output</pre>
      </div>
    </div>

  </div>

  <!-- SEMAR Modal (copy from lesson1 for consistency) -->
  <div id="semarModal" class="semar-modal" style="display:none;">
    <div class="semar-modal-content">
      <span id="semarModalClose" class="semar-modal-close">&times;</span>
      <div id="semarModalStatus" class="semar-modal-status">
        <div class="semar-modal-spinner"></div>
        <div class="semar-modal-message">Sending data to SEMAR...</div>
      </div>
    </div>
  </div>

  <!-- External JS -->
  <script src="{{ url_for('static', filename='js/scenario1/lesson2.js') }}"></script>

</body>

</html>